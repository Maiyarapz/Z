local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "ZenXhub", 
    SubTitle = "By Zenrift",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = false, 
    Theme = "Dark", 
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- [[ ระบบปุ่มลอยกะทัดรัด (ZX) สำหรับมือถือ ]]
local ScreenGui = Instance.new("ScreenGui")
local ToggleButton = Instance.new("TextButton")
local UICorner = Instance.new("UICorner")
local UIStroke = Instance.new("UIStroke")

ScreenGui.Name = "ZenXToggleGui"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ResetOnSpawn = false

ToggleButton.Name = "ZenXButton"
ToggleButton.Parent = ScreenGui
ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
ToggleButton.Position = UDim2.new(0.02, 0, 0.2, 0)
ToggleButton.Size = UDim2.new(0, 45, 0, 45)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = "ZX"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 12.000
ToggleButton.Active = true
ToggleButton.Draggable = true 

UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = ToggleButton

UIStroke.Thickness = 1.5
UIStroke.Color = Color3.fromRGB(255, 255, 255)
UIStroke.Parent = ToggleButton

ToggleButton.MouseButton1Click:Connect(function()
    game:GetService("VirtualInputManager"):SendKeyEvent(true, Enum.KeyCode.LeftControl, false, game)
    game:GetService("VirtualInputManager"):SendKeyEvent(false, Enum.KeyCode.LeftControl, false, game)
end)

-- [[ 1. Global Configuration ]]
getgenv().AutoFarmNearby = false
getgenv().NearbyDistance = 70 
getgenv().SelectedMonsters = {}
getgenv().AutoFarmAllBoss = false
getgenv().FarmDistance = 8
getgenv().AutoEquip = false
getgenv().SelectedWeapon = "None"
getgenv().AutoSkill = false
getgenv().AutoDungeon = false
getgenv().AutoDungeonNearby = false
getgenv().SelectedDungeonType = "None"
getgenv().SelectedDifficulty = "Easy"
getgenv().AutoVoteDifficulty = false
getgenv().AutoReplayDungeon = false
getgenv().AutoStrongestBoss = false
getgenv().SelectedStrongestBoss = "StrongestToday"
getgenv().SelectedStrongestDifficulty = "Normal"
getgenv().AntiAfk = true 

local BossList = {"Alucard", "Aizen", "Madoka", "Jinwoo", "Gojo", "Sukuna", "Yuji", "Cid"}
local IslandPatrol = {"Sailor", "Shibuya", "HuecoMundo", "Valentine"}

-- [[ 2. Core Logic Functions ]]

local function EquipWeaponLogic()
    pcall(function()
        if getgenv().AutoEquip and getgenv().SelectedWeapon ~= "None" then
            local char = game.Players.LocalPlayer.Character
            if char and not char:FindFirstChild(getgenv().SelectedWeapon) then
                local tool = game.Players.LocalPlayer.Backpack:FindFirstChild(getgenv().SelectedWeapon)
                if tool then char.Humanoid:EquipTool(tool) end
            end
        end
    end)
end

local function BossAttack()
    pcall(function()
        local remote = game:GetService("ReplicatedStorage"):WaitForChild("CombatSystem"):WaitForChild("Remotes"):WaitForChild("RequestHit")
        if remote then 
            remote:FireServer() 
            if getgenv().AutoSkill then
                local vim = game:GetService("VirtualInputManager")
                for _, key in pairs({"Z", "X", "C", "V", "F"}) do
                    vim:SendKeyEvent(true, key, false, game)
                    task.wait(0.01)
                    vim:SendKeyEvent(false, key, false, game)
                end
            end
        end
    end)
end

local function GetDungeonEnemy()
    local char = game.Players.LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    for _, v in pairs(game.Workspace:GetDescendants()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v.Humanoid.MaxHealth > 10 and v ~= char then
            return v
        end
    end
    return nil
end

local function GetStrongestBossPrecision()
    local char = game.Players.LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    for _, v in pairs(game.Workspace:GetDescendants()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") then
            if v ~= char and v.Humanoid.Health > 0 then
                if v.Name:lower():find("strongest") and v.Humanoid.MaxHealth >= 100000000 then
                    return v
                end
            end
        end
    end
    return nil
end

-- [[ 3. UI Tabs ]]
local Tabs = {
    Main = Window:AddTab({ Title = "ฟาร์มหลัก", Icon = "swords" }),
    Dungeon = Window:AddTab({ Title = "ดันเจี้ยน/บอส", Icon = "swords" }), -- ไอคอนดาบตามคำขอ
    Settings = Window:AddTab({ Title = "ตั้งค่าระบบ", Icon = "settings" })
}

-- [[ 4. Tab: Main Farm (Patrol System) ]]
Tabs.Main:AddSection("Island Patrol")
Tabs.Main:AddToggle("Patrol", {
    Title = "เริ่มเดินสายตบบอส (Island Patrol)",
    Default = false,
    Callback = function(Value)
        getgenv().AutoFarmAllBoss = Value
        task.spawn(function()
            local islandIndex = 1
            while getgenv().AutoFarmAllBoss do
                local currentIsland = IslandPatrol[islandIndex]
                game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("TeleportToPortal"):FireServer(currentIsland)
                task.wait(6) 
                -- Logic เดิมจาก V30.16
                islandIndex = (islandIndex % #IslandPatrol) + 1
                task.wait(2)
            end
        end)
    end
})

-- [[ 5. Tab: Dungeon & Strongest Boss (The Re-Added Systems) ]]
Tabs.Dungeon:AddSection("Dungeon Clear System")

Tabs.Dungeon:AddDropdown("DungeonType", {
    Title = "เลือกประเภทดันเจี้ยน",
    Values = {"CidDungeon", "RuneDungeon"},
    Default = "None",
    Callback = function(v) getgenv().SelectedDungeonType = v end
})

Tabs.Dungeon:AddDropdown("DungeonDiff", {
    Title = "ระดับความยาก (Dungeon)",
    Values = {"Easy", "Medium", "Hard", "Extreme"},
    Default = "Easy",
    Callback = function(v) getgenv().SelectedDifficulty = v end
})

Tabs.Dungeon:AddToggle("AutoDungeonFull", {
    Title = "เริ่มเคลียร์ดันเจี้ยน (Full Clear)",
    Default = false,
    Callback = function(Value)
        getgenv().AutoDungeon = Value
        task.spawn(function()
            while getgenv().AutoDungeon do
                task.wait(1)
                if getgenv().SelectedDungeonType ~= "None" then
                    game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("RequestDungeonPortal"):FireServer(getgenv().SelectedDungeonType)
                    task.wait(2)
                    game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("TeleportToPortal"):FireServer("Dungeon")
                    task.wait(5)
                    while getgenv().AutoDungeon do
                        task.wait(0.1)
                        local enemy = GetDungeonEnemy()
                        if enemy then
                            while getgenv().AutoDungeon and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 do
                                task.wait(0.05)
                                EquipWeaponLogic()
                                local char = game.Players.LocalPlayer.Character
                                if char and char:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChild("HumanoidRootPart") then
                                    char.HumanoidRootPart.CFrame = enemy.HumanoidRootPart.CFrame * CFrame.new(0, getgenv().FarmDistance, 0) * CFrame.Angles(math.rad(-90), 0, 0)
                                    BossAttack()
                                end
                            end
                        end
                    end
                end
            end
        end)
    end
})

Tabs.Dungeon:AddToggle("AutoVote", { Title = "เลือกความยากอัตโนมัติ (Vote)", Default = false, Callback = function(v) getgenv().AutoVoteDifficulty = v end })
Tabs.Dungeon:AddToggle("AutoReplay", { Title = "กดเริ่มใหม่ (Replay)", Default = false, Callback = function(v) getgenv().AutoReplayDungeon = v end })

Tabs.Dungeon:AddSection("Strongest Boss Mode")

Tabs.Dungeon:AddDropdown("StrongestSelect", {
    Title = "เลือกบอส Strongest",
    Values = {"StrongestToday", "StrongestHistory"},
    Default = "StrongestToday",
    Callback = function(v) getgenv().SelectedStrongestBoss = v end
})

Tabs.Dungeon:AddDropdown("StrongestDiff", {
    Title = "ความยาก (Strongest)",
    Values = {"Normal", "Medium", "Hard", "Extreme"},
    Default = "Normal",
    Callback = function(v) getgenv().SelectedStrongestDifficulty = v end
})

Tabs.Dungeon:AddToggle("AutoStrongest", {
    Title = "ฟาร์ม Strongest Boss",
    Default = false,
    Callback = function(Value)
        getgenv().AutoStrongestBoss = Value
        task.spawn(function()
            while getgenv().AutoStrongestBoss do
                task.wait(1)
                game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("TeleportToPortal"):FireServer("Shinjuku")
                task.wait(2)
                local spawnArgs = {[1] = getgenv().SelectedStrongestBoss, [2] = getgenv().SelectedStrongestDifficulty}
                game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("RequestSpawnStrongestBoss"):FireServer(unpack(spawnArgs))
                while getgenv().AutoStrongestBoss do
                    task.wait(0.05)
                    local target = GetStrongestBossPrecision()
                    if target then
                        local char = game.Players.LocalPlayer.Character
                        local root = char and char:FindFirstChild("HumanoidRootPart")
                        local tRoot = target:FindFirstChild("HumanoidRootPart")
                        if root and tRoot then
                            root.CFrame = tRoot.CFrame * CFrame.new(0, getgenv().FarmDistance, 0) * CFrame.Angles(math.rad(-90), 0, 0)
                            BossAttack()
                        end
                    else
                        task.wait(3)
                        if getgenv().AutoStrongestBoss then
                            game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("RequestSpawnStrongestBoss"):FireServer(unpack(spawnArgs))
                        end
                    end
                end
            end
        end)
    end
})

-- [[ 6. Tab: Settings ]]
Tabs.Settings:AddSection("Combat Settings")
Tabs.Settings:AddToggle("AutoSkill", { Title = "ใช้สกิลอัตโนมัติ (Z-F)", Default = false, Callback = function(v) getgenv().AutoSkill = v end })
Tabs.Settings:AddToggle("AutoEquip", { Title = "สวมใส่อาวุธอัตโนมัติ", Default = false, Callback = function(v) getgenv().AutoEquip = v end })

Tabs.Settings:AddSlider("AttackDist", {
    Title = "ระยะห่างการฟาร์ม",
    Default = 8, Min = 0, Max = 15, Rounding = 1,
    Callback = function(v) getgenv().FarmDistance = v end
})
Tabs.Settings:AddToggle("AntiAfk", { Title = "Anti-AFK", Default = true, Callback = function(v) getgenv().AntiAfk = v end })

-- [[ Background Logic ]]
task.spawn(function()
    while true do
        task.wait(3)
        if getgenv().AutoVoteDifficulty then
            pcall(function() game:GetService("ReplicatedStorage").Remotes.DungeonWaveVote:FireServer(getgenv().SelectedDifficulty) end)
        end
        if getgenv().AutoReplayDungeon then
            pcall(function() game:GetService("ReplicatedStorage").Remotes.DungeonWaveReplayVote:FireServer("sponsor") end)
        end
    end
end)

local VirtualUser = game:GetService("VirtualUser")
game.Players.LocalPlayer.Idled:Connect(function()
    if getgenv().AntiAfk then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

Window:SelectTab(1)
Fluent:Notify({ Title = "ZenXhub", Content = "ระบบ Strongest Boss และ Dungeon กลับมาแล้วครับ!", Duration = 5 })
