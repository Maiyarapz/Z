local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "ZenXhub", 
    SubTitle = "By Zenrift",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = false, 
    Theme = "Dark", 
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- [[ ระบบปุ่มลอยขนาดกะทัดรัด (Compact Floating Button) ]]
local ScreenGui = Instance.new("ScreenGui")
local ToggleButton = Instance.new("TextButton")
local UICorner = Instance.new("UICorner")
local UIStroke = Instance.new("UIStroke")

ScreenGui.Name = "ZenXToggleGui"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ResetOnSpawn = false

ToggleButton.Name = "ZenXButton"
ToggleButton.Parent = ScreenGui
ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0) -- สีแดง ZenX
-- ปรับขนาดเป็น 45x45 (เล็กแต่พอดีนิ้ว)
ToggleButton.Position = UDim2.new(0.02, 0, 0.2, 0)
ToggleButton.Size = UDim2.new(0, 45, 0, 45)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = "ZX" -- ใช้ตัวย่อเพื่อให้ดูสะอาดตา
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 12.000
ToggleButton.Active = true
ToggleButton.Draggable = true -- ยังคงลากย้ายตำแหน่งได้

UICorner.CornerRadius = UDim.new(0, 12) -- ความมนที่พอดีกับปุ่มเล็ก
UICorner.Parent = ToggleButton

UIStroke.Thickness = 1.5
UIStroke.Color = Color3.fromRGB(255, 255, 255)
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
UIStroke.Parent = ToggleButton

-- ฟังก์ชันเปิด/ปิด
ToggleButton.MouseButton1Click:Connect(function()
    game:GetService("VirtualInputManager"):SendKeyEvent(true, Enum.KeyCode.LeftControl, false, game)
    game:GetService("VirtualInputManager"):SendKeyEvent(false, Enum.KeyCode.LeftControl, false, game)
end)

-- [[ 1. Global Configuration ]]
getgenv().AutoFarmNearby = false
getgenv().NearbyDistance = 70 
getgenv().SelectedMonsters = {}
getgenv().AutoFarmAllBoss = false
getgenv().FarmDistance = 8
getgenv().AutoEquip = false
getgenv().SelectedWeapon = "None"
getgenv().AutoSkill = false
getgenv().AntiAfk = true 

-- [[ 2. Core Logic (V30.16) ]]
local function EquipWeaponLogic()
    pcall(function()
        if getgenv().AutoEquip and getgenv().SelectedWeapon ~= "None" then
            local char = game.Players.LocalPlayer.Character
            if char and not char:FindFirstChild(getgenv().SelectedWeapon) then
                local tool = game.Players.LocalPlayer.Backpack:FindFirstChild(getgenv().SelectedWeapon)
                if tool then char.Humanoid:EquipTool(tool) end
            end
        end
    end)
end

local function BossAttack()
    pcall(function()
        local remote = game:GetService("ReplicatedStorage"):WaitForChild("CombatSystem"):WaitForChild("Remotes"):WaitForChild("RequestHit")
        if remote then 
            remote:FireServer() 
            if getgenv().AutoSkill then
                local vim = game:GetService("VirtualInputManager")
                for _, key in pairs({"Z", "X", "C", "V", "F"}) do
                    vim:SendKeyEvent(true, key, false, game)
                    task.wait(0.01)
                    vim:SendKeyEvent(false, key, false, game)
                end
            end
        end
    end)
end

local function GetMultiTargetMonster()
    local char = game.Players.LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") or #getgenv().SelectedMonsters == 0 then return nil end
    local closest = nil
    local shortestDist = getgenv().NearbyDistance
    for _, v in pairs(game.Workspace:GetDescendants()) do
        local isSelected = false
        for _, selectedName in pairs(getgenv().SelectedMonsters) do if v.Name == selectedName then isSelected = true break end end
        if isSelected and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v:FindFirstChild("HumanoidRootPart") then
            local magnitude = (char.HumanoidRootPart.Position - v.HumanoidRootPart.Position).Magnitude
            if magnitude <= shortestDist then closest = v shortestDist = magnitude end
        end
    end
    return closest
end

-- [[ 3. UI Tabs ]]
local Tabs = {
    Main = Window:AddTab({ Title = "ฟาร์มหลัก", Icon = "swords" }),
    Settings = Window:AddTab({ Title = "ตั้งค่า", Icon = "settings" })
}

-- ระบบฟาร์ม
local MonsterDropdown = Tabs.Main:AddDropdown("Monsters", {
    Title = "เลือกมอนสเตอร์",
    Values = {"None"},
    Multi = true,
    Default = {},
    Callback = function(Value)
        local t = {}
        for k, _ in pairs(Value) do table.insert(t, k) end
        getgenv().SelectedMonsters = t
    end
})

Tabs.Main:AddButton({
    Title = "รีเฟรชมอนสเตอร์",
    Callback = function()
        local Monsters = {}
        for _, v in pairs(game.Workspace:GetDescendants()) do
            if v:IsA("Model") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                if not table.find(Monsters, v.Name) then table.insert(Monsters, v.Name) end
            end
        end
        MonsterDropdown:SetValues(Monsters)
    end
})

Tabs.Main:AddToggle("AutoFarm", {
    Title = "เริ่มฟาร์ม (Auto Farm)",
    Default = false,
    Callback = function(Value)
        getgenv().AutoFarmNearby = Value
        task.spawn(function()
            while getgenv().AutoFarmNearby do
                task.wait(0.1)
                local target = GetMultiTargetMonster()
                if target and target:FindFirstChild("HumanoidRootPart") then
                    while getgenv().AutoFarmNearby and target.Humanoid.Health > 0 do
                        task.wait(0.01)
                        local char = game.Players.LocalPlayer.Character
                        if char and char:FindFirstChild("HumanoidRootPart") then
                            EquipWeaponLogic()
                            char.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
                            char.HumanoidRootPart.CFrame = target.HumanoidRootPart.CFrame * CFrame.new(0, getgenv().FarmDistance, 0) * CFrame.Angles(math.rad(-90), 0, 0)
                            BossAttack()
                        end
                    end
                end
            end
        end)
    end
})

-- ระบบ Anti-AFK
local VirtualUser = game:GetService("VirtualUser")
game.Players.LocalPlayer.Idled:Connect(function()
    if getgenv().AntiAfk then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

Window:SelectTab(1)
Fluent:Notify({ Title = "ZenXhub", Content = "โหลดปุ่ม ZX ขนาดกะทัดรัดเรียบร้อย!", Duration = 5 })
