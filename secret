local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

-- [[ 0. UI Cleanup System ]]
-- ลบ UI เก่าทิ้งทันทีถ้ามีการรันซ้ำ เพื่อป้องกันปุ่ม ZX ซ้อนกัน
if game:GetService("CoreGui"):FindFirstChild("ZenXToggleGui") then
    game:GetService("CoreGui"):FindFirstChild("ZenXToggleGui"):Destroy()
end

local Window = Fluent:CreateWindow({
    Title = "ZenXhub", 
    SubTitle = "By Zenrift",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = false, 
    Theme = "Dark", 
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- [[ ระบบปุ่มลอย ZX ]]
local ScreenGui = Instance.new("ScreenGui")
local ToggleButton = Instance.new("TextButton")
ScreenGui.Name = "ZenXToggleGui"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ResetOnSpawn = false

ToggleButton.Name = "ZenXButton"
ToggleButton.Parent = ScreenGui
ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
ToggleButton.Position = UDim2.new(0.02, 0, 0.2, 0)
ToggleButton.Size = UDim2.new(0, 45, 0, 45)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = "ZX"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Draggable = true 
Instance.new("UICorner", ToggleButton).CornerRadius = UDim.new(0, 12)
local Stroke = Instance.new("UIStroke", ToggleButton)
Stroke.Color = Color3.fromRGB(255, 255, 255)
Stroke.Thickness = 1.5

ToggleButton.MouseButton1Click:Connect(function()
    game:GetService("VirtualInputManager"):SendKeyEvent(true, Enum.KeyCode.LeftControl, false, game)
    game:GetService("VirtualInputManager"):SendKeyEvent(false, Enum.KeyCode.LeftControl, false, game)
end)

-- [[ 1. Global Configuration ]]
getgenv().AutoFarmNearby = false
getgenv().NearbyDistance = 70 
getgenv().SelectedMonsters = {}
getgenv().AutoFarmAllBoss = false
getgenv().FarmDistance = 8
getgenv().AutoEquip = false
getgenv().SelectedWeapon = "None"
getgenv().AutoSkill = false
getgenv().AutoDungeon = false
getgenv().AutoDungeonNearby = false
getgenv().SelectedDungeonType = "None"
getgenv().SelectedDifficulty = "Easy"
getgenv().AutoVoteDifficulty = false
getgenv().AutoReplayDungeon = false
getgenv().AutoStrongestBoss = false
getgenv().SelectedStrongestBoss = "StrongestToday"
getgenv().SelectedStrongestDifficulty = "Normal"
getgenv().AntiAfk = true 

local BossList = {"Alucard", "Aizen", "Madoka", "Jinwoo", "Gojo", "Sukuna", "Yuji", "Cid"}
local IslandPatrol = {"Sailor", "Shibuya", "HuecoMundo", "Valentine"}

-- [[ 2. Core Precision Functions ]]

local function GetMyInventory()
    local Tools = {"None"}
    pcall(function()
        for _, v in pairs(game.Players.LocalPlayer.Backpack:GetChildren()) do table.insert(Tools, v.Name) end
        for _, v in pairs(game.Players.LocalPlayer.Character:GetChildren()) do if v:IsA("Tool") then table.insert(Tools, v.Name) end end
    end)
    return Tools
end

local function EquipWeaponLogic()
    if getgenv().AutoEquip and getgenv().SelectedWeapon ~= "None" then
        pcall(function()
            local char = game.Players.LocalPlayer.Character
            if char and not char:FindFirstChild(getgenv().SelectedWeapon) then
                local tool = game.Players.LocalPlayer.Backpack:FindFirstChild(getgenv().SelectedWeapon)
                if tool then char.Humanoid:EquipTool(tool) end
            end
        end)
    end
end

local function GetTargetModel(IsBoss, IsDungeon, IsPatrol)
    local char = game.Players.LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    
    local target = nil
    local shortestDist = (IsDungeon or IsPatrol) and math.huge or getgenv().NearbyDistance
    
    for _, v in pairs(game.Workspace:GetDescendants()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v ~= char then
            local root = v:FindFirstChild("HumanoidRootPart")
            if root then
                if IsBoss and (v.Name:lower():find("strongest") or v.Name:lower():find(getgenv().SelectedStrongestBoss:lower())) then
                    return v -- ล็อคบอสทันที
                elseif IsDungeon then
                    return v -- ตีตัวอะไรก็ได้ในดันเจี้ยน
                elseif IsPatrol then
                    for _, bName in pairs(BossList) do
                        if v.Name:lower():find(bName:lower()) then return v end
                    end
                elseif not IsBoss and not IsDungeon and not IsPatrol then
                    if table.find(getgenv().SelectedMonsters, v.Name) then
                        local dist = (char.HumanoidRootPart.Position - root.Position).Magnitude
                        if dist <= shortestDist then
                            target = v
                            shortestDist = dist
                        end
                    end
                end
            end
        end
    end
    return target
end

local function ActionAttack(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    pcall(function()
        local char = game.Players.LocalPlayer.Character
        EquipWeaponLogic()
        char.HumanoidRootPart.CFrame = target.HumanoidRootPart.CFrame * CFrame.new(0, getgenv().FarmDistance, 0) * CFrame.Angles(math.rad(-90), 0, 0)
        char.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
        
        game:GetService("ReplicatedStorage").CombatSystem.Remotes.RequestHit:FireServer()
        
        if getgenv().AutoSkill then
            local vim = game:GetService("VirtualInputManager")
            for _, key in pairs({"Z", "X", "C", "V", "F"}) do
                vim:SendKeyEvent(true, key, false, game)
                task.wait(0.005)
                vim:SendKeyEvent(false, key, false, game)
            end
        end
    end)
end

-- [[ 3. UI Tabs ]]
local Tabs = {
    Main = Window:AddTab({ Title = "ฟาร์มหลัก", Icon = "swords" }),
    Dungeon = Window:AddTab({ Title = "ดันเจี้ยน/บอส", Icon = "swords" }),
    Settings = Window:AddTab({ Title = "ตั้งค่าระบบ", Icon = "settings" })
}

-- หมวด: Auto Farm Monster Nearby
Tabs.Main:AddSection("Auto Farm Monster Nearby")
local MonDrop = Tabs.Main:AddDropdown("MonSelect", { Title = "เลือกมอนสเตอร์", Values = {"None"}, Multi = true, Callback = function(v) 
    local t = {} for k,_ in pairs(v) do table.insert(t, k) end getgenv().SelectedMonsters = t 
end })
Tabs.Main:AddButton({ Title = "รีเฟรชมอนสเตอร์", Callback = function() 
    local list = {} for _, v in pairs(game.Workspace:GetDescendants()) do if v:IsA("Model") and v:FindFirstChild("Humanoid") then if not table.find(list, v.Name) then table.insert(list, v.Name) end end end
    MonDrop:SetValues(list)
end })
Tabs.Main:AddToggle("TogNearby", { Title = "โจมตีมอนสเตอร์ที่เลือก", Default = false, Callback = function(v) getgenv().AutoFarmNearby = v end })

-- หมวด: BOSS System
Tabs.Dungeon:AddSection("BOSS Management")
Tabs.Dungeon:AddDropdown("BossS", { Title = "เลือกบอสที่จะโจมตี", Values = {"StrongestToday", "StrongestHistory"}, Default = "StrongestToday", Callback = function(v) getgenv().SelectedStrongestBoss = v end })
Tabs.Dungeon:AddToggle("TogSOnly", { Title = "โจมตีแค่บอสที่เลือก", Default = false, Callback = function(v) getgenv().AutoStrongestBoss = v end })
Tabs.Dungeon:AddToggle("TogPatrol", { Title = "โจมตีบอสทั้งหมด (Patrol)", Default = false, Callback = function(v) getgenv().AutoFarmAllBoss = v end })

-- หมวด: Dungeon System
Tabs.Dungeon:AddSection("Dungeon System")
Tabs.Dungeon:AddDropdown("DT", { Title = "เลือกดันเจี้ยน", Values = {"CidDungeon", "RuneDungeon"}, Default = "None", Callback = function(v) getgenv().SelectedDungeonType = v end })
Tabs.Dungeon:AddDropdown("DD", { Title = "เลือกความยาก", Values = {"Easy", "Medium", "Hard", "Extreme"}, Default = "Easy", Callback = function(v) getgenv().SelectedDifficulty = v end })
Tabs.Dungeon:AddToggle("VT", { Title = "เริ่มโหวตความยาก (Vote)", Default = false, Callback = function(v) getgenv().AutoVoteDifficulty = v end })
Tabs.Dungeon:AddToggle("RT", { Title = "เริ่มกดเริ่มต้นใหม่ (Replay)", Default = false, Callback = function(v) getgenv().AutoReplayDungeon = v end })
Tabs.Dungeon:AddToggle("CT", { Title = "เคลียร์ดันเจี้ยน (Clear)", Default = false, Callback = function(v) getgenv().AutoDungeon = v end })
Tabs.Dungeon:AddToggle("ST", { Title = "เคลียร์ดันเจี้ยนใกล้ตัว (Smart Scan)", Default = false, Callback = function(v) getgenv().AutoDungeonNearby = v end })

-- หมวด: ตั้งค่าระบบ
Tabs.Settings:AddSection("General & Protection")
Tabs.Settings:AddToggle("AntiAfk", { Title = "ระบบ Anti AFK", Default = true, Callback = function(v) getgenv().AntiAfk = v end })
local WepDrop = Tabs.Settings:AddDropdown("WepS", { Title = "เลือกอาวุธ", Values = GetMyInventory(), Default = "None", Callback = function(v) getgenv().SelectedWeapon = v end })
Tabs.Settings:AddButton({ Title = "รีเฟรช อาวุธ (Melee/Sword/Power)", Callback = function() WepDrop:SetValues(GetMyInventory()) end })
Tabs.Settings:AddToggle("AEquip", { Title = "ออโต้ใส่อาวุธ", Default = false, Callback = function(v) getgenv().AutoEquip = v end })
Tabs.Settings:AddToggle("ASkill", { Title = "ออโต้ใช้สกิล (Z X C V F)", Default = false, Callback = function(v) getgenv().AutoSkill = v end })
Tabs.Settings:AddSlider("ADist", { Title = "ระยะโจมตี (เริ่มต้น 8)", Default = 8, Min = 0, Max = 15, Rounding = 1, Callback = function(v) getgenv().FarmDistance = v end })
Tabs.Settings:AddSlider("SDist", { Title = "Smart Scan Distance (เริ่มต้น 70)", Default = 70, Min = 10, Max = 1000, Rounding = 10, Callback = function(v) getgenv().NearbyDistance = v end })

-- [[ 4. Main Farm Loop (Precision Optimized) ]]
task.spawn(function()
    while task.wait(0.01) do
        if getgenv().AutoStrongestBoss then
            ActionAttack(GetTargetModel(true, false, false))
        elseif getgenv().AutoDungeon or getgenv().AutoDungeonNearby then
            ActionAttack(GetTargetModel(false, true, false))
        elseif getgenv().AutoFarmAllBoss then
            ActionAttack(GetTargetModel(false, false, true))
        elseif getgenv().AutoFarmNearby then
            ActionAttack(GetTargetModel(false, false, false))
        end
    end
end)

-- Background Tasks (Vote/Replay)
task.spawn(function()
    while task.wait(3) do
        if getgenv().AutoVoteDifficulty then pcall(function() game:GetService("ReplicatedStorage").Remotes.DungeonWaveVote:FireServer(getgenv().SelectedDifficulty) end) end
        if getgenv().AutoReplayDungeon then pcall(function() game:GetService("ReplicatedStorage").Remotes.DungeonWaveReplayVote:FireServer("sponsor") end) end
    end
end)

-- Anti-AFK & Cleanup
game.Players.LocalPlayer.Idled:Connect(function()
    if getgenv().AntiAfk then game:GetService("VirtualUser"):CaptureController() game:GetService("VirtualUser"):ClickButton2(Vector2.new()) end
end)

-- ปลดล็อคระบบเลื่อน (Auto Adjust)
task.spawn(function()
    while task.wait(0.5) do
        pcall(function()
            for _, tab in pairs(Tabs) do
                if tab.Container and tab.Container:FindFirstChild("ScrollingFrame") then
                    local scroll = tab.Container.ScrollingFrame
                    scroll.CanvasSize = UDim2.new(0, 0, 0, scroll.UIListLayout.AbsoluteContentSize.Y + 80)
                end
            end
        end)
    end
end)

Window:SelectTab(1)
Fluent:Notify({ Title = "ZenXhub", Content = "โหลดระบบสมบูรณ์ 100% พร้อม Precision Targeting", Duration = 5 })
